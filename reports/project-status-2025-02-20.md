# Project Status — 2025-02-20
## 1. Completed Work to Date
### Monorepo, Tooling, and Quality Gates
- Rebuilt the workspace around pnpm and Turbo so lint, typecheck, test, and build steps fan out across every package via shared scripts and pipeline definitions, establishing the slice roadmap’s required tooling baseline.【F:package.json†L1-L28】【F:pnpm-workspace.yaml†L1-L4】【F:turbo.json†L1-L1】
- Centralised linting through a flat ESLint 9 configuration that unifies browser, Node, and Vitest globals with package-aware overrides, keeping React, Next.js, API, and script code under a single ruleset.【F:eslint.config.mjs†L4-L256】
- Hardened CI to provision Postgres, wait for readiness, run Prisma migrations, and only then execute lint/type/test so schema drift is caught automatically in pull requests.【F:.github/workflows/ci.yml†L18-L78】
### Backend & Data Foundations
- Authored Slice 0’s Prisma schema, baseline migration, and expanded seed script to cover users, creator profiles, role assignments, audit logs, feature flags, and creator code generation aligned with the vertical plan’s role model.【F:apps/api/prisma/schema.prisma†L1-L120】【F:apps/api/prisma/migrations/20250220000000_slice0_init/migration.sql†L1-L112】【F:apps/api/prisma/seed.ts†L13-L197】
- Bootstrapped NestJS with environment validation, global Prisma access, a shared audit service, and feature modules for auth, roles, feature flags, audit, and telemetry that expose DTO-backed controllers while enforcing a global validation pipe and `/api` prefix.【F:apps/api/src/app.module.ts†L1-L27】【F:apps/api/src/config/env.validation.ts†L1-L75】【F:apps/api/src/audit/audit.controller.ts†L1-L23】【F:apps/api/src/auth/auth.controller.ts†L1-L20】【F:apps/api/src/roles/roles.controller.ts†L1-L20】【F:apps/api/src/feature-flags/feature-flags.controller.ts†L1-L26】【F:apps/api/src/telemetry/telemetry.controller.ts†L1-L23】【F:apps/api/src/main.ts†L7-L20】
- Implemented service logic and unit specs that hash passwords, persist audit logs, manage role upgrades, evaluate feature flags with overrides, and expose telemetry health/metrics endpoints backed by Prisma mocks for regression coverage.【F:apps/api/src/auth/auth.service.ts†L19-L133】【F:apps/api/src/audit/audit.service.ts†L6-L37】【F:apps/api/src/roles/roles.service.ts†L21-L169】【F:apps/api/src/feature-flags/feature-flags.service.ts†L21-L149】【F:apps/api/src/telemetry/telemetry.service.ts†L10-L37】【F:apps/api/src/auth/auth.service.spec.ts†L27-L99】【F:apps/api/src/roles/roles.service.spec.ts†L27-L113】【F:apps/api/src/feature-flags/feature-flags.service.spec.ts†L27-L122】【F:apps/api/src/telemetry/telemetry.service.spec.ts†L1-L47】
- Delivered JWT-backed session issuance with hashed refresh-token persistence, guard-protected management controllers, and Vitest e2e coverage validating authenticated role flows.【F:apps/api/src/auth/auth.service.ts†L19-L161】【F:apps/api/src/auth/token.service.ts†L15-L162】【F:apps/api/src/auth/jwt-auth.guard.ts†L1-L45】【F:apps/api/src/roles/roles.controller.ts†L1-L20】【F:apps/api/src/feature-flags/feature-flags.controller.ts†L1-L26】【F:apps/api/test/auth-roles.e2e.spec.ts†L1-L241】
- Documented the Slice 0 API surface and seed expectations so downstream consumers know how to exercise the new endpoints and local fixtures.【F:apps/api/README.md†L1-L34】
### Web PWA Developer Experience
- Added local Vitest type declarations, TS config wiring, and a custom runner script so the web workspace can type-check and execute tests without relying on hoisted dependencies from other packages.【F:apps/web/types/vitest/index.d.ts†L1-L163】【F:apps/web/types/vitest/globals.d.ts†L1-L23】【F:apps/web/types/vitest/config.d.ts†L1-L43】【F:apps/web/types/vitest/importMeta.d.ts†L1-L11】【F:apps/web/tsconfig.json†L1-L24】【F:apps/web/scripts/run-vitest.mjs†L1-L50】
- Updated the web package scripts so `pnpm --filter @shellff/web test` resolves the Vitest CLI from pnpm’s virtual store, keeping local and CI executions aligned.【F:apps/web/package.json†L1-L29】【F:apps/web/scripts/run-vitest.mjs†L1-L50】
### Install, Ops, and Infrastructure Scaffolding
- Restored install tooling with a committed environment template and cross-platform bootstrap and seed scripts that set up `.env`, verify prerequisites, and run Prisma migrations/seeds for contributors.【F:install/.env.example†L1-L11】【F:install/scripts/bootstrap.sh†L1-L30】【F:install/scripts/bootstrap.ps1†L1-L38】【F:install/scripts/seed.sh†L1-L5】【F:install/scripts/seed.ps1†L1-L5】
- Reintroduced Docker Compose services for Postgres, Redis, MinIO, and Prometheus plus a matching Prometheus scrape config to support local Slice 0 development flows.【F:docker-compose.yml†L1-L51】【F:monitoring/prometheus.yml†L1-L7】
- Rebuilt Terraform modules for network, database, cache, storage, observability, and app workloads, then wired a staging environment layer with opt-in toggles for each resource group.【F:infra/terraform/modules/network/main.tf†L1-L68】【F:infra/terraform/modules/database/main.tf†L1-L43】【F:infra/terraform/modules/cache/main.tf†L1-L39】【F:infra/terraform/modules/storage/main.tf†L1-L29】【F:infra/terraform/modules/observability/main.tf†L1-L9】【F:infra/terraform/modules/app/main.tf†L1-L58】【F:infra/terraform/environments/staging/main.tf†L1-L59】【F:infra/terraform/environments/staging/variables.tf†L1-L68】
## 2. Remaining Scope
### Authentication & Authorization
- Add refresh/rotation endpoints that exercise the persisted refresh-token grants; the auth controller still exposes only signup and login despite the service storing hashed refresh tokens for rotation.【F:apps/api/src/auth/auth.controller.ts†L1-L19】【F:apps/api/src/auth/auth.service.ts†L109-L161】
- Layer role-based authorization on the newly guarded management routes so only privileged actors can grant roles or toggle feature flags; the shared JWT guard authenticates requests but does not yet enforce role policies across controllers.【F:apps/api/src/auth/jwt-auth.guard.ts†L1-L45】【F:apps/api/src/roles/roles.controller.ts†L1-L20】【F:apps/api/src/feature-flags/feature-flags.controller.ts†L1-L26】
### Feature Flags & Audit Experience
- Introduce caching or memoisation for flag evaluation and provide pagination/filtering on audit listings; every evaluation hits Prisma and `/audit/logs` only supports a fixed `limit` query today.【F:apps/api/src/feature-flags/feature-flags.service.ts†L21-L40】【F:apps/api/src/audit/audit.controller.ts†L18-L22】
- Expand flag APIs with richer telemetry/analytics hooks so downstream slices can observe flag rollout impacts; current audit metadata only captures basic on/off changes.【F:apps/api/src/feature-flags/feature-flags.service.ts†L42-L110】
### Telemetry & Monitoring
- Extend telemetry metrics beyond process uptime/memory to cover dependency health, Prisma query latency, and queue/worker readiness needed for later slices.【F:apps/api/src/telemetry/telemetry.service.ts†L10-L37】
- Emit structured failure telemetry when dependencies are unavailable to complement the health check exception path.【F:apps/api/src/telemetry/telemetry.service.ts†L10-L25】
### Tooling & Operations
- Mirror the CI wait-and-migrate flow in local onboarding scripts so contributors get automatic readiness checks before `db:seed`; existing scripts run migrations without confirming Postgres is reachable.【F:.github/workflows/ci.yml†L65-L78】【F:install/scripts/seed.sh†L1-L5】【F:install/scripts/seed.ps1†L1-L5】
- Document the new auth/feature-flag requirements (headers, environment variables) across install docs and package READMEs for frontend consumers.【F:apps/api/README.md†L6-L34】【F:install/.env.example†L1-L11】
### Testing & QA
- Add controller or e2e tests that exercise Prisma against a real database; existing unit specs mock Prisma and will not catch integration regressions introduced by migrations or DTO changes.【F:apps/api/src/auth/auth.service.spec.ts†L9-L99】【F:apps/api/src/roles/roles.service.spec.ts†L33-L113】【F:apps/api/src/feature-flags/feature-flags.service.spec.ts†L33-L122】
### “Unlock issues” Remediation Track
- Finish the pending migrations, seeds, and API updates for the physical unlock flow so barcode decoding, redemption persistence, and release access records align with the new schema guidance documented earlier in the audit.【F:where-we-are.txt†L81-L189】
- Add automated coverage (unit/integration/E2E) for redemption journeys once the domain changes land to keep regressions from reappearing.【F:where-we-are.txt†L93-L108】
## 3. Immediate Next Action
- Prioritise session lifecycle endpoints and role-based policies on the guarded management APIs—ship refresh/logout flows and admin/moderator gating before deepening telemetry workstreams.【F:apps/api/src/auth/auth.controller.ts†L1-L19】【F:apps/api/src/auth/auth.service.ts†L109-L161】【F:apps/api/src/auth/jwt-auth.guard.ts†L1-L45】【F:apps/api/src/roles/roles.controller.ts†L1-L20】【F:apps/api/src/feature-flags/feature-flags.controller.ts†L1-L26】